{"version":3,"sources":["../../src/services/auth.service.ts"],"sourcesContent":["import { hash, compare } from 'bcrypt';\nimport config from 'config';\nimport { sign } from 'jsonwebtoken';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, TokenData } from '@interfaces/auth.interface';\nimport { User } from '@interfaces/users.interface';\nimport userModel from '@models/users.model';\nimport { isEmpty } from '@utils/util';\n\nclass AuthService {\n  public users = userModel;\n\n  public async signup(userData: CreateUserDto): Promise<User> {\n    if (isEmpty(userData)) throw new HttpException(400, \"You're not userData\");\n\n    const findUser: User = await this.users.findOne({ email: userData.email });\n    if (findUser) throw new HttpException(409, `You're email ${userData.email} already exists`);\n\n    const hashedPassword = await hash(userData.password, 10);\n    const createUserData: User = await this.users.create({ ...userData, password: hashedPassword });\n\n    return createUserData;\n  }\n\n  public async login(userData: CreateUserDto): Promise<{ cookie: string; findUser: User }> {\n    if (isEmpty(userData)) throw new HttpException(400, \"You're not userData\");\n\n    const findUser: User = await this.users.findOne({ email: userData.email });\n    if (!findUser) throw new HttpException(409, `You're email ${userData.email} not found`);\n\n    const isPasswordMatching: boolean = await compare(userData.password, findUser.password);\n    if (!isPasswordMatching) throw new HttpException(409, \"You're password not matching\");\n\n    const tokenData = this.createToken(findUser);\n    const cookie = this.createCookie(tokenData);\n\n    return { cookie, findUser };\n  }\n\n  public async logout(userData: User): Promise<User> {\n    if (isEmpty(userData)) throw new HttpException(400, \"You're not userData\");\n\n    const findUser: User = await this.users.findOne({ email: userData.email, password: userData.password });\n    if (!findUser) throw new HttpException(409, `You're email ${userData.email} not found`);\n\n    return findUser;\n  }\n\n  public createToken(user: User): TokenData {\n    const dataStoredInToken: DataStoredInToken = { _id: user._id };\n    const secretKey: string = config.get('secretKey');\n    const expiresIn: number = 60 * 60;\n\n    return { expiresIn, token: sign(dataStoredInToken, secretKey, { expiresIn }) };\n  }\n\n  public createCookie(tokenData: TokenData): string {\n    return `Authorization=${tokenData.token}; HttpOnly; Max-Age=${tokenData.expiresIn};`;\n  }\n}\n\nexport default AuthService;\n"],"names":["AuthService","signup","userData","findUser","users","findOne","email","hashedPassword","password","createUserData","create","login","isPasswordMatching","tokenData","createToken","cookie","createCookie","logout","user","dataStoredInToken","_id","secretKey","get","expiresIn","token"],"mappings":"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"}