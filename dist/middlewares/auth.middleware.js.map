{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import config from 'config';\nimport { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport userModel from '@models/users.model';\n\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  try {\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\n\n    if (Authorization) {\n      const secretKey: string = config.get('secretKey');\n      const verificationResponse = (await verify(Authorization, secretKey)) as DataStoredInToken;\n      const userId = verificationResponse._id;\n      const findUser = await userModel.findById(userId);\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, 'Wrong authentication token'));\n      }\n    } else {\n      next(new HttpException(404, 'Authentication token missing'));\n    }\n  } catch (error) {\n    next(new HttpException(401, 'Wrong authentication token'));\n  }\n};\n\nexport default authMiddleware;\n"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","secretKey","get","verificationResponse","userId","_id","findUser","findById","user","error"],"mappings":";;;;;AAAmB,GAAQ,CAAR,OAAQ;AAEJ,GAAc,CAAd,aAAc;AACP,GAA2B,CAA3B,cAA2B;AAEnC,GAAqB,CAArB,WAAqB;;;;;;AAE3C,KAAK,CAACA,cAAc,UAAUC,GAAoB,EAAEC,GAAa,EAAEC,IAAkB,GAAK,CAAC;IACzF,GAAG,CAAC,CAAC;QACH,KAAK,CAACC,aAAa,GAAGH,GAAG,CAACI,OAAO,CAAC,CAAe,oBAAMJ,GAAG,CAACK,MAAM,CAAC,CAAe,kBAAIL,GAAG,CAACK,MAAM,CAAC,CAAe,gBAAEC,KAAK,CAAC,CAAS,UAAE,CAAC,IAAI,IAAI;QAE3I,EAAE,EAAEH,aAAa,EAAE,CAAC;YAClB,KAAK,CAACI,SAAS,GAZF,OAAQ,SAYYC,GAAG,CAAC,CAAW;YAChD,KAAK,CAACC,oBAAoB,GAAI,KAAK,KAXlB,aAAc,SAWYN,aAAa,EAAEI,SAAS;YACnE,KAAK,CAACG,MAAM,GAAGD,oBAAoB,CAACE,GAAG;YACvC,KAAK,CAACC,QAAQ,GAAG,KAAK,CAVN,WAAqB,SAUJC,QAAQ,CAACH,MAAM;YAEhD,EAAE,EAAEE,QAAQ,EAAE,CAAC;gBACbZ,GAAG,CAACc,IAAI,GAAGF,QAAQ;gBACnBV,IAAI;YACN,CAAC,MAAM,CAAC;gBACNA,IAAI,CAAC,GAAG,CAlBc,cAA2B,eAkB1B,GAAG,EAAE,CAA4B;YAC1D,CAAC;QACH,CAAC,MAAM,CAAC;YACNA,IAAI,CAAC,GAAG,CArBgB,cAA2B,eAqB5B,GAAG,EAAE,CAA8B;QAC5D,CAAC;IACH,CAAC,CAAC,KAAK,EAAEa,KAAK,EAAE,CAAC;QACfb,IAAI,CAAC,GAAG,CAxBkB,cAA2B,eAwB9B,GAAG,EAAE,CAA4B;IAC1D,CAAC;AACH,CAAC;eAEcH,cAAc"}